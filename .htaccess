<IfModule mod_rewrite.c>
    RewriteEngine On

    # 0. Prevent Loop: If it's already index.php, stop.
    RewriteRule ^api/index\.php$ - [L]

    # 1. API Requests -> Sent to PHP Router
    # Only rewrite if it's NOT a real file
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} ^/api
    RewriteRule ^api/.* api/index.php [L,QSA]

    # 2. Frontend Requests (SPA) -> index.html
    # If the file/dir doesn't exist, serve React's index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/api
    RewriteRule . /index.html [L]
</IfModule>

# Security Headers (NSA Level)
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
